#!/bin/bash

set -o nounset
set -o errexit
set -o pipefail

## V.HANOKA, juillet 2010.
# Script permettant d'obtenir différentes informations sur
# les données produites lors de l'évaluation du/des tagger(s):
#
#     * Le graphique des scores en fonction des échantillons
#       pour chaque langue (data/ALL-RESULTS-GRAPH.png),
#
#     * Les données numériques correspondantes et leur sommaire
#       (data/ALL-RESULTS.txt),
#
#     * Le classement des erreurs par ordre de fréquence décroissant
#       pour chaque langue *L* indiquée (data/ALL-ERRORS-*L*.txt),
#
#     * Les matrices de confusion (data/ALL-MATRIX-*L*.png) et la correspondance
#       des indices des axes et des tags (data/ALL-MATRIX-*L*.corresp).
#
#     * Une synthèse de ces informations dans un fichier pdf.

# Position of this script on the computer
EVAL_PATH=`dirname $0`

source $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/lima-pelf-functions.sh


if (($#==0)); then
    echo usage: detailed-res.sh nb-slices language
fi
date=$(date);

# rm -f data/*

nbParts=$1
lang=$2
shift 2

###################
# Extract results #
###################

method=$(readMethod $lang)
echo -e "Method is $method"

# rm -Rf results.$lang.$method/data
install -d results.$lang.$method/data
destfile=results.$lang.$method/data/ALL-RESULTS.txt
graphfile=results.$lang.$method/data/ALL-RESULTS-GRAPH.png

rm -f $destfile;
touch $destfile;
# echo -n -e "${lang}.${method}" >> $destfile;
# echo  >> $destfile;
micro=$($EVAL_PATH/eval.pl results.$lang.$method/aligned \
  | grep "precision" \
  | grep -v "all"  \
  | gawk -F "precision\t" '{print $2}' \
  | sed -e 's/%.*//g')

echo -n -e "${lang}.${method}: $micro\t"
echo -n -e "${lang}.${method}: $micro\t">> $destfile;


#######################################
# Errors Ranking and Confusion Matrix #
#######################################

echo -n "   *  Errors classification for $lang"
$EVAL_PATH/erreursFrequentes.pl $lang $method $nbParts

echo "$EVAL_PATH/confusionMatrix.sh $lang $method $nbParts"
$EVAL_PATH/confusionMatrix.sh $lang $method $nbParts

echo "$EVAL_PATH/toPDF.sh synthese.$lang.$method.pdf $lang $method;"
$EVAL_PATH/toPDF.sh synthese.$lang.$method.pdf $lang $method

echo "$0 DONE"
